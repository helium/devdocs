import Arduino_Board_Discovery from '../images/device/Arduino_Board_Discovery.png' 
import Arduino_Board_PartNumber from '../images/device/Arduino_Board_PartNumber.png' 
import Arduino_Compile from '../images/device/Arduino_Compile.png' 
import LongFi_Example from '../images/device/LongFi_Example.png' 
import LongFi_Library from '../images/device/LongFi_library.png' 
import upload_sketch from '../images/device/upload_sketch.png' 
import upload_success from '../images/device/Arduino_Upload_Successful.png'
import request_bin from '../images/console/request_bin.png' 
import pasted_endpoint from '../images/console/pasted_endpoint.png' 
import set_channel_as_default from '../images/console/set_channel_as_default.gif' 
import device_packets from '../images/console/no_channel_packets.png'
import disco_board from '../images/device/disco_board.png'
import console_device_details from '../images/console/console_device_details.png'
import MCCI_Library from '../images/device/library_manager.png'

import Compile_Upload from '../images/device/t-arduino-compileupload.jpeg'
import Libraries from '../images/device/t-arduino-libraries.jpeg'
import LMIC from '../images/device/t-arduino-lmic.jpeg'
import Menu001 from '../images/device/t-arduino-menu001.jpeg'
import Menu002 from '../images/device/t-arduino-menu002.jpeg'
import Menu003 from '../images/device/t-arduino-menu003.jpeg'
import Menu004 from '../images/device/t-arduino-menu004.jpeg'
import Menu005 from '../images/device/t-arduino-menu005.jpeg'
import Menu006 from '../images/device/t-arduino-menu006.jpeg'
import Menu007 from '../images/device/t-arduino-menu007.jpeg'
import Menu008 from '../images/device/t-arduino-menu008.jpeg'
import Menu009 from '../images/device/t-arduino-menu009.jpeg'
import Port001 from '../images/device/t-arduino-port001.jpeg'
import Port002 from '../images/device/t-arduino-port002.jpeg'
import Prefs001 from '../images/device/t-arduino-preferences001.jpeg'
import Prefs002 from '../images/device/t-arduino-preferences002.jpeg'
import Prefs003 from '../images/device/t-arduino-preferences003.jpeg'
import Prefs004 from '../images/device/t-arduino-preferences004.jpeg'
import SerialMon001 from '../images/device/t-arduino-serialmon001.jpeg'
import SerialMon002 from '../images/device/t-arduino-serialmon002.jpeg'
import BoardsManager from '../images/device/t-boardsmanager.jpeg'
import TestDevice from '../images/device/t-Console_testdevice.png'
import Manager001 from '../images/device/t-device-manager001.jpeg'
import Manager002 from '../images/device/t-device-manager002.jpeg'
import Chart001 from '../images/device/t-helium-console-chart002.jpeg'
import Chart002 from '../images/device/t-helium-console-chart004.jpeg'
import Graph001 from '../images/device/t-helium-console-graph.jpeg'
import Console001 from '../images/device/t-helium-console001.jpeg'
import Console002 from '../images/device/t-helium-console002.jpeg'
import Console003 from '../images/device/t-helium-console003.jpeg'
import Console004 from '../images/device/t-helium-console004.jpeg'
import Console005 from '../images/device/t-helium-console005.jpeg'
import Console006 from '../images/device/t-helium-console006.jpeg'
import DeviceLog001 from '../images/device/t-helium-device-log001.jpeg'
import Key001 from '../images/device/t-helium-key001.jpeg'
import Key002 from '../images/device/t-helium-key002.jpeg'
import Key003 from '../images/device/t-helium-key003.jpeg'
import Key004 from '../images/device/t-helium-key004.jpeg'
import Key005 from '../images/device/t-helium-key005.jpeg'
import Key006 from '../images/device/t-helium-key006.jpeg'
import NewDevice001 from '../images/device/t-helium-newdevice.jpeg'
import RequestBin001 from '../images/device/t-requestbin.jpeg'
import Stm32Board001 from '../images/device/t-stm32-001.jpg'
import Stm32Board002 from '../images/device/t-stm32-002.jpg'
import Stm32Mount from '../images/device/t-stm32-mount.jpeg'

# LongFi Arduino Quickstart

<img src={Stm32Board001} /> 



## Introduction

Helium’s LongFi architecture combines LoRaWAN and the Helium blockchain to create a wireless peer-to-peer network for low-bandwidth IoT applications. This guide will show you step by step how to transmit LoRaWAN packets using a longfi-arduino sketch on an STMicroelectronics B-L072Z-LRWAN1 Discovery kit.

>##### Important!
>Before we begin, please make sure you've followed the steps from this [guide](/console/quickstart), which goes over some initial setup steps.


[Objective](#objective)

[Hardware Setup](#hardware-setup)

[LongFi Example Sketch and Sending Data](#longfi-example-sketch-and-sending-data)


## Objective and Requirements 
[objective]: #objective

In this guide, you will learn:

* How to setup your environment (Add STM32 board support to Arduino IDE and STLink debugging utility)
* How to build and program a basic application that will send packets over the Helium Network
* Verify real-time packets sent to the Helium Console via Hotspot that's in range
 
For this example, you will need the following:

### Hardware

* <a href="https://www.st.com/en/evaluation-tools/b-l072z-lrwan1.html" target="_blank">STMicroelectronics B-L072Z-LRWAN1 Discovery kit</a>
* Micro USB Type B Cable - <a href="https://www.amazon.com/AmazonBasics-Male-Micro-Cable-Black/dp/B0719H12WD/ref=sr_1_2_sspa?" target="_blank">Example </a>

### Software

* <a href="https://www.arduino.cc/en/Main/Software" target="_blank">Arduino software (IDE)</a> 
* <a href="https://github.com/stm32duino/Arduino_Core_STM32#getting-started" target="_blank">STM32 Board Support</a> 
* <a href="https://www.st.com/en/development-tools/stm32cubeprog.html" target="_blank">STLink Debugging Utility</a> 
* <a href="https://console.helium.com/" target="_blank">Helium Console</a> 

## Hardware Setup
[hardware-setup]: #hardware-setup

The build for this project is easy! You’ll just need to install the included antenna.  
 
We'll be using the ST-Link debugger on the Discovery board, so you'll want to connect the micro-USB B connector to the micro-USB port labeled `CN7 USB STLINK`.
 
<img src={disco_board} /> 

If you will be running the device using the AAA battery supply, you will need to remove a resistor on the underside of the board. We can just move it over to one of the pads and leave it attached for later. **You don't have to worry about this right now, as we will be powering the board off the MicroUSB connection.**
<img src={Stm32Board002} /> 

That’s it for the hardware setup! Next we will setup your environment. We are going to use the Arduino IDE here. (Intsructions on how do use <a href="https://platformio.org/" target="_blank">PlatformIO</a> for this will be added soon.)

### Getting the Arduino IDE


Download and install the latest version of <a href="https://www.arduino.cc/en/Main/Software" target="_blank">Arduino IDE </a> for your preferred OS. 
 
* <a href="https://www.arduino.cc/en/Guide/Windows" target="_blank">Windows </a>
* <a href="https://www.arduino.cc/en/Guide/linux" target="_blank">Linux </a>
* <a href="https://www.arduino.cc/en/Guide/MacOSX" target="_blank">Mac OSX</a>

### Add STM32 board support to Arduino
 
<img src={Prefs001}/>

And add the following line under "Additional Boards Manager URLs":
```
https://github.com/stm32duino/BoardManagerFiles/raw/master/STM32/package_stm_index.json
```

<img src={Prefs003}/>

Now go to your `Boards Manager`, Select the "STM32 Cores" and click on Install:

<img src={Menu001}/>
<img src={BoardsManager}/>


### Install MCCI LoRaWAN LMIC Library
 
The MCCI LoRaWAN LMIC Library then needs to be installed from the Arduino IDE if you don't already have it.  

> ##### Important! 
> If you have already installed the MCCI LMIC library, please make sure to check for updates.

From inside the Arduino IDE:

```
Sketch -> Include Libraries -> Manage Libraries 
```

Search for `MCCI LMIC` and install the latest version of `MCCI LoRaWAN LMIC Library` 

<img src={MCCI_Library} /> 



## LongFi Example Sketch and Sending Data
[longfi-example-sketch-and-sending-data]: #longfi-example-sketch-and-sending-data

This <a href="https://github.com/helium/longfi-arduino/blob/master/longfi-us915/longfi-us915.ino" target="_blank">an example sketch</a> is included in the LongFi repository and we'll be using it for this demo.

To deploy it, create a new sketch and copy the source code over. All you need to do is update it with the the `DevEUI`, `AppEUI`, and `AppKey` generated for you when you [create a device](/console/quickstart) in [Helium Console](https://console.helium.com).

Note that the byte ordering of the `DevEUI`, `AppEUI`, and `AppKey` are important. 

* `DevEUI` and `AppEUI` need to be copied over in the `LSB` format. 
* `AppKey` needs to be input using `MSB`

 <img src={Key003}/>
 
 <img src={Key004}/>

Be sure to select the appropriate format and copy the information into the sketch:

```
static const u1_t PROGMEM DEVEUI[8]= {0xDE, 0xAD, 0xBE, 0xEF, 0xFE, 0xED, 0xFF, 0xFF };
void os_getDevEui (u1_t* buf) { memcpy_P(buf, DEVEUI, 8);}

static const u1_t PROGMEM APPEUI[8]= { 0x81, 0x6A, 0xE9, 0xDD, 0x50, 0xD8, 0x16, 0x8B };
void os_getArtEui (u1_t* buf) { memcpy_P(buf, APPEUI, 8);}

static const u1_t PROGMEM APPKEY[16] = { 0x29, 0xFE, 0xF6, 0x75, 0x97, 0x18, 0xE3, 0x25, 0x72, 0x64, 0xBA, 0x25, 0x82, 0x8C, 0x94, 0xFA };
void os_getDevKey (u1_t* buf) {  memcpy_P(buf, APPKEY, 16);}
```

### Adding B-L072Z-LRWAN1 Board Support 

You then need to configuring the Arduino IDE for the `B-L072Z-LRWAN1 - ST STM32L0 Discovery kit`. (Full istructions to install the board support package can be found <a href="https://github.com/stm32duino/Arduino_Core_STM32#getting-started" target="_blank">here</a> but we'll walk you through it below.)


In the Arduino IDE:


```
Select Tools -> Board -> Discovery
```
 
<img src={Menu002} /> 
 

```
Select Tools -> Board part number -> Discovery L072Z-LRWAN1
```

<img src={Menu003} />
<img src={Menu004} />
<img src={Menu005} /> 
<img src={Menu006} />
<img src={Menu007} />
<img src={Menu008} />

### Programming (Upload Method)

Now we're ready to upload our Sketch. For this, we will use the onboard ST-Link (Flasher/Debugger).
 
Download and install the required utility from ST <a href="https://www.st.com/en/development-tools/stm32cubeprog.html" target="_blank">here</a> 

The download comes in the form of a `stm32cubeprog.zip` file, which you'll need to unpack. After you unzip, you should see the following files:

```
SetupSTM32CubeProgrammer-[version].exe

SetupSTM32CubeProgrammer-[version].linux
SetupSTM32CubeProgrammer-[version].app
```

### Installation Requirements

**Supported operating systems and architectures**
* Linux 64-bit 
* Windows 7/8/10 32-bit and 64-bit 
* MacOS (minimum version OS X Yosemite)

**Software Requirements**
* <a href="https://www.oracle.com/technetwork/java/javase/downloads/jre8-downloads-2133155.html" target="_blank">Java SE Run Time Environment 1.8</a> or newer must be installed (from Oracle)


### Windows Instructions

The download comes with a `SetupSTM32CubeProgrammer-[version].exe`, which guides you through the installation process. 

### Linux Instructions

The download comes with a `SetupSTM32CubeProgrammer-[version].linux`, which guides you through the installation process. 

### MacOS Instructions

Run the following command: 

`java -jar SetupSTM32CubeProgrammer-[version].exe`

**You should use the default installation path.** 

In the Arduino IDE:

```
Select Tools -> Upload Method -> STM32CubeProgrammer(SWD)
```

<img src={Menu009} />

### Programming your Arduino Sketch and Sending Data

From the Arduino IDE:

```
Select Sketch -> Verify/Compile (Ctrl + R)
```

 
If there are no errors with your sketch, you should see `Done Compiling`.

Then, you can upload the sketch and program the development board. 
 
Arduino IDE:

```
Select Sketch -> Upload (Ctrl + U)
```

 
Congratulations! You have just programmed your first Helium LongFi application! 

However, we are not done just yet. Now let's head back to [Helium Console](https://console.helium.com) and look at our device. 

You should be able to see some packets appear as Live Data. 

<img src={device_packets} />










